<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscar Localidad con GeoNames</title>
</head>
<body>
  <h2>Buscar localidad y obtener datos de ubicación</h2>

  <label for="localidad">Localidad:</label>
  <input type="text" id="localidad" placeholder="Escribe una localidad">

  <button onclick="buscarLocalidad()">Buscar</button>

  <h3>Resultado:</h3>
  <label for="nacionalidad">Nacionalidad (país):</label>
  <input type="text" id="nacionalidad" readonly><br>

  <label for="estado">Estado:</label>
  <input type="text" id="estado" readonly><br>

  <label for="municipio">Municipio:</label>
  <input type="text" id="municipio" readonly><br>

  <script>
    async function buscarLocalidad() {
      const localidad = document.getElementById("localidad").value;
      const username = "rojasdev"; // <-- Reemplaza esto con tu usuario de GeoNames

      if (!localidad) {
        alert("Por favor escribe una localidad.");
        return;
      }

      const url = `https://secure.geonames.org/searchJSON?q=${encodeURIComponent(localidad)}&maxRows=1&username=${username}`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (data.geonames && data.geonames.length > 0) {
          const lugar = data.geonames[0];
          console.log("Resultado de búsqueda:", lugar);

          // Mostrar nacionalidad y estado
          document.getElementById("nacionalidad").value = lugar.countryName || "No disponible";
          document.getElementById("estado").value = lugar.adminName1 || "No disponible";

          // Paso adicional: Obtener más detalles por geonameId
          const detalleUrl = `https://secure.geonames.org/getJSON?geonameId=${lugar.geonameId}&username=${username}`;
          const detalleResponse = await fetch(detalleUrl);
          const detalleData = await detalleResponse.json();
          console.log("Detalle:", detalleData);

          document.getElementById("municipio").value = detalleData.adminName2 || "No disponible";
        } else {
          alert("No se encontró la localidad.");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("Error al consultar GeoNames.");
      }
    }
  </script>
</body>
</html>
